<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>NeoBrutal Finance — Rewritten Sorting + Fully Clickable Expansions</title>
<style>
  * { box-sizing: border-box; }
  body { margin: 0; padding: 24px; background: #0f172a; color: #111827; font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial; display: grid; place-items: start center; min-height: 100vh; }

  .phone { width: 375px; height: 812px; border-radius: 42px; background: #0b0f1a; position: relative; box-shadow: 0 20px 50px rgba(0,0,0,.6); overflow: hidden; }
  .notch { position: absolute; top: 10px; left: 50%; transform: translateX(-50%); width: 180px; height: 30px; background: #000; border-bottom-left-radius: 18px; border-bottom-right-radius: 18px; z-index: 10; }

  .screen { position: absolute; inset: 10px; border-radius: 34px; overflow-y: auto; background: #fef08a; color: #111827; }
  .header { display: flex; align-items: center; justify-content: space-between; padding: 18px; position: sticky; top: 0; background: #fef08a; border-bottom: 4px solid #111827; z-index: 5; }
  .divider { height: 4px; background: #111827; width: 100%; }

  .widgets { padding-bottom: 100px; position: relative; }

  .card { position: relative; background: #fef3c7; border: 4px solid #111827; border-radius: 18px; box-shadow: 8px 8px 0 #111827; margin: 18px; padding: 14px; transition: transform .18s ease; }
  .value { font-weight: 800; font-size: 24px; }

  /* Drag handle (left) */
  .handle { position: absolute; top: 10px; left: 10px; background: #111827; color: #fef08a; border-radius: 6px; padding: 4px 6px; display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: grab; user-select: none; -webkit-user-select: none; -webkit-tap-highlight-color: transparent; touch-action: manipulation; z-index: 2; }
  .handle:active { cursor: grabbing; }
  .dot-vert { width: 4px; height: 4px; border-radius: 50%; background: #fef08a; margin: 2px 0; }

  /* Expand button (right) */
  .expand-btn { position: absolute; top: 10px; right: 10px; background: #111827; color: #fef08a; border: none; border-radius: 6px; padding: 4px 6px; display: flex; align-items: center; justify-content: center; cursor: pointer; z-index: 2; }
  .dot-horz { width: 4px; height: 4px; border-radius: 50%; background: #fef08a; margin: 0 2px; }

  .news-item { display: flex; gap: 12px; align-items: center; background: #fef3c7; border: 4px solid #111827; border-radius: 18px; box-shadow: 4px 4px 0 #111827; padding: 10px; margin-bottom: 10px; }
  .thumb { width: 64px; height: 64px; background: #111827; border-radius: 10px; flex-shrink: 0; }
  .news-text { font-size: 14px; }
  .news-text span { display: block; font-size: 12px; color: #6b7280; }

  /* Sortable visuals */
  .drag-ghost { opacity: .7; transform: rotate(1.2deg); }
  .chosen { transform: scale(1.01); }
  .dragging { cursor: grabbing; }

  /* Overlay */
  .overlay-bg { position: absolute; inset: 0; background: rgba(17,24,39,0.45); backdrop-filter: blur(4px); opacity: 0; pointer-events: none; transition: opacity .22s ease; z-index: 10; display: none; }
  .overlay-bg.active { display: block; opacity: 1; pointer-events: auto; }
  .overlay-card { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -40%) scale(.9); width: 340px; height: 620px; background: #fef3c7; border: 4px solid #111827; border-radius: 24px; box-shadow: 12px 12px 0 #111827; padding: 20px; opacity: 0; overflow-y: auto; transition: transform .26s cubic-bezier(.2,.8,.2,1), opacity .2s ease; z-index: 20; display: none; }
  .overlay-card.active { display: block; transform: translate(-50%, -50%) scale(1); opacity: 1; }

  .scroll-locked { overflow: hidden !important; }
</style>
</head>
<body>
  <div class="phone">
    <div class="notch"></div>
    <div class="screen" id="screen">
      <div class="header"><h2>NeoBrutal Finance</h2><span>▲ 9.8%</span></div>
      <div class="divider"></div>

      <div class="widgets" id="widgets">
        <div class="card" data-title="Total Balance" data-summary="Steady monthly growth driven by tech and energy sectors.">
          <div class="handle" aria-label="Drag to reorder" role="button" tabindex="0"><div class="dot-vert"></div><div class="dot-vert"></div><div class="dot-vert"></div></div>
          <button class="expand-btn" type="button"><div class="dot-horz"></div><div class="dot-horz"></div><div class="dot-horz"></div></button>
          <div>Total Balance</div><div class="value">$128,450</div>
          <svg viewBox="0 0 300 140" fill="none" stroke="#111827" stroke-width="3"><path d="M0,100 C60,70 120,110 180,80 240,50 300,100 300,100" /></svg>
        </div>

        <div class="card" data-title="Performance (30d)" data-summary="Equities up 5%, bonds slightly down, stable risk profile.">
          <div class="handle" aria-label="Drag to reorder" role="button" tabindex="0"><div class="dot-vert"></div><div class="dot-vert"></div><div class="dot-vert"></div></div>
          <button class="expand-btn" type="button"><div class="dot-horz"></div><div class="dot-horz"></div><div class="dot-horz"></div></button>
          <div>Performance (30d)</div>
          <svg viewBox="0 0 300 140"><rect x="10" y="90" width="20" height="50" fill="#111827"/><rect x="40" y="70" width="20" height="70" fill="#111827"/><rect x="70" y="110" width="20" height="30" fill="#ef4444"/><rect x="100" y="60" width="20" height="80" fill="#111827"/><rect x="130" y="85" width="20" height="55" fill="#111827"/><rect x="160" y="40" width="20" height="100" fill="#111827"/></svg>
        </div>

        <div class="card" data-title="Market News" data-summary="Fed speech boosts tech; oil declines; earnings strong.">
          <div class="handle" aria-label="Drag to reorder" role="button" tabindex="0"><div class="dot-vert"></div><div class="dot-vert"></div><div class="dot-vert"></div></div>
          <button class="expand-btn" type="button"><div class="dot-horz"></div><div class="dot-horz"></div><div class="dot-horz"></div></button>
          <div class="news-item"><div class="thumb"></div><div class="news-text"><strong>Markets Rally After Fed Speech</strong><span>Dow +1.2% | 20m ago</span></div></div>
          <div class="news-item"><div class="thumb"></div><div class="news-text"><strong>Oil Prices Fall Again</strong><span>Energy sector slides 3%</span></div></div>
        </div>
      </div>

      <div class="overlay-bg" id="overlay"></div>
      <div class="overlay-card" id="overlayCard"></div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
  <script>
    const screen = document.getElementById('screen');
    const widgets = document.getElementById('widgets');
    const overlay = document.getElementById('overlay');
    const overlayCard = document.getElementById('overlayCard');

    // --- Robust Sortable config (vertical list, handle-only, touch friendly) ---
    const sortable = new Sortable(widgets, {
      animation: 200,
      easing: 'cubic-bezier(.2,.8,.2,1)',
      direction: 'vertical',
      handle: '.handle',
      ghostClass: 'drag-ghost',
      chosenClass: 'chosen',
      dragClass: 'dragging',
      forceFallback: true,          // consistent on iOS
      fallbackOnBody: true,
      fallbackTolerance: 3,
      delayOnTouchOnly: true,
      delay: 0,
      filter: '.expand-btn, .expand-btn *', // clicks on expand never start drag
      preventOnFilter: true,
    });

    // --- Expansions: attach listeners to ALL current & future widgets via delegation ---
    widgets.addEventListener('click', (e) => {
      const expand = e.target.closest('.expand-btn');
      if (!expand || !widgets.contains(expand)) return;
      e.stopPropagation();
      e.preventDefault();
      const card = expand.closest('.card');
      openOverlay(card);
    });

    overlay.addEventListener('click', closeOverlay);

    function lockScroll(lock){
      if (lock) screen.classList.add('scroll-locked'); else screen.classList.remove('scroll-locked');
    }

    function openOverlay(card){
      const title = card.dataset.title || '';
      const summary = card.dataset.summary || '';
      const svg = card.querySelector('svg') ? card.querySelector('svg').outerHTML : '';
      overlayCard.innerHTML = `
        <button class="expand-btn" id="overlayClose" type="button" style="position: sticky; top: 8px; float: right;">
          <div class="dot-horz"></div><div class="dot-horz"></div><div class="dot-horz"></div>
        </button>
        <h3 style="margin:8px 0 10px 0;">${title}</h3>
        ${svg}
        <p style="margin-top:10px;font-size:14px;">${summary}</p>
        <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Vestibulum vel dolor eget massa viverra convallis. Integer ac lacinia nisl. Nulla facilisi. Cras imperdiet nunc a nibh tristique, vitae tempus magna consequat. Morbi id gravida nibh. Aliquam erat volutpat. Curabitur euismod, nisl a fermentum venenatis, ex dui pretium justo, nec congue arcu lorem ac purus.</p>
        <p>Vivamus vulputate viverra sapien, ac feugiat magna congue vitae. Fusce porttitor semper enim. Praesent at odio eget libero auctor hendrerit. Sed ultricies, leo id interdum porttitor, ipsum lorem eleifend neque, at iaculis purus nisl id erat. Donec pretium nibh eget erat tincidunt, sed congue elit aliquam. Integer lacinia nibh in felis hendrerit, ut lacinia lacus cursus.</p>
        <p>In hac habitasse platea dictumst. Morbi gravida nibh nec nibh elementum ultrices. Curabitur aliquet, lacus et iaculis gravida, nunc neque aliquet elit, quis luctus nisl lectus ut ligula. Proin at velit vitae lectus consequat auctor. Sed sed nibh in quam tempus venenatis. Etiam id aliquam nibh. Donec rutrum, dui ut vulputate ultricies, augue lorem gravida lorem, sed varius justo purus sed lorem.</p>
        <p>Maecenas vel ligula gravida, interdum libero id, volutpat lacus. Integer nec arcu fermentum, rhoncus nibh ac, tincidunt nibh. Suspendisse potenti. Curabitur semper arcu non eros pellentesque, at vulputate justo convallis. Aenean a lorem sed lorem accumsan volutpat a vitae est. Integer id placerat tellus.</p>
        <p>Aenean consequat, arcu quis sollicitudin blandit, diam felis eleifend ipsum, eget dignissim diam arcu sed massa. Pellentesque sed dignissim mauris. Aliquam accumsan nunc eget eros lacinia, a tincidunt mauris pretium.</p>
      `;
      overlay.classList.add('active');
      overlayCard.classList.add('active');
      lockScroll(true);
      document.getElementById('overlayClose').addEventListener('click', (ev)=>{ ev.stopPropagation(); closeOverlay(); });
    }

    function closeOverlay(){
      overlay.classList.remove('active');
      overlayCard.classList.remove('active');
      lockScroll(false);
    }
  </script>
</body>
</html>
